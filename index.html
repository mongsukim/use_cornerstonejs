<!DOCTYPE html>
<html>
<head>
    <script src="https://unpkg.com/cornerstone-core@2.3.0/dist/cornerstone.min.js"></script>
    <script src="https://unpkg.com/cornerstone-wado-image-loader@3.0.0/dist/cornerstoneWADOImageLoader.min.js"></script>
    <script src="https://unpkg.com/dicom-parser@1.8.6/dist/dicomParser.min.js"></script>
</head>
<body>
<div id="dicomImage" style="width: 512px; height: 512px; border: 1px solid black;"></div>
<div>
    <button id="prevImage">Previous</button>
    <button id="nextImage">Next</button>
</div>
<script>
    cornerstoneWADOImageLoader.external.cornerstone = cornerstone;
    cornerstoneWADOImageLoader.external.dicomParser = dicomParser;
    cornerstoneWADOImageLoader.configure({
        beforeSend: function(xhr) {
            // Add custom headers here (if needed)
        }
    });

    const element = document.getElementById('dicomImage');
    cornerstone.enable(element);

    let dicomFiles = [];
    let currentIndex = 0;

    function loadAndDisplayImage(index) {
        if (index >= 0 && index < dicomFiles.length) {
            const imageId = dicomFiles[index];
            cornerstone.loadAndCacheImage(imageId).then(function(image) {
                cornerstone.displayImage(element, image);
            }).catch(function(error) {
                console.error('Error loading image:', error);
            });
        }
    }

    document.getElementById('prevImage').addEventListener('click', function() {
        if (currentIndex > 0) {
            currentIndex--;
            loadAndDisplayImage(currentIndex);
        }
    });

    document.getElementById('nextImage').addEventListener('click', function() {
        if (currentIndex < dicomFiles.length - 1) {
            currentIndex++;
            loadAndDisplayImage(currentIndex);
        }
    });

    fetch('http://localhost:8001/dicom-files')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
            }
            return response.json();
        })
        .then(data => {
            dicomFiles = data;
            loadAndDisplayImage(currentIndex);
        })
        .catch(error => console.error('Error fetching DICOM files:', error));
</script>
</body>
</html>